# SecureBeam Caddy Configuration
# Automatic HTTPS with Let's Encrypt

# Main website
securebeam.eu, www.securebeam.eu {
    # Frontend (Vue app)
    reverse_proxy frontend:80

    # Compression
    encode gzip zstd

    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        -Server
    }
}

# Mailbox API (WebSocket for Magic Wormhole)
mailbox.securebeam.eu {
    reverse_proxy mailbox-server:3030

    # Enable WebSocket support
    @websocket {
        header Connection *Upgrade*
        header Upgrade websocket
    }
    reverse_proxy @websocket mailbox-server:3030
}

# Relay server info endpoint (optional)
relay.securebeam.eu {
    respond "SecureBeam Relay Server - Port 4001" 200
}
